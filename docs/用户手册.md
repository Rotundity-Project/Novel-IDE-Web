# Novel-IDE-Web 用户手册（Phase 1）

> Status: Implemented（仅覆盖当前已实现的 Phase 1 能力）

## 1. 你可以做什么

- 注册/登录账号
- 创建作品（Work）
- 创建与重排章节（Chapter）
- 在章节页面编辑内容（Lexical 编辑器）

## 2. 访问入口

- Web 应用：`http://localhost:3000`
- API 健康检查：`http://localhost:3000/api/v1/health`

## 3. 账号与登录

### 3.1 注册
1. 打开 `/register`
2. 输入邮箱、用户名、密码并提交
3. 注册成功后会获得 access/refresh token

### 3.2 登录
1. 打开 `/login`
2. 输入邮箱与密码并提交

### 3.3 登录状态与令牌
- 当前实现将 access token 存在浏览器 `localStorage`（键：`nsw_access_token`）。
- refresh token 同样存 `localStorage`（键：`nsw_refresh_token`）。

注意：
- access token 过期后，请调用刷新接口获取新 access token。
- 登出会撤销该用户的所有 refresh token（需要 Redis 或开发环境内存降级）。

## 4. 作品与章节

### 4.1 进入作品列表
- 打开 `/works` 查看你的作品列表

### 4.2 创建作品
1. 在作品页创建新作品
2. 创建成功后进入作品详情页

### 4.3 管理章节
- 在作品详情页中创建章节
- 章节按 `orderIndex` 排序
- 支持批量重排章节顺序

### 4.4 编辑章节
- 在章节详情页编辑内容
- 内容保存会回写 `wordCount`，并维护作品 `totalWords`

## 5. 常见问题（FAQ）

### 5.1 访问 API 返回 500（表不存在/关系不存在）
原因：数据库未迁移或迁移失败。

解决：
- 本地开发：执行 `pnpm --filter server db:migrate`
- Docker：确保 `migrate` 服务先成功完成

### 5.2 登出后仍可刷新 token（或刷新行为不一致）
原因：开发环境 Redis 连接失败会降级为内存实现，撤销不持久化。

解决：
- 启动本地 Redis，确保 `REDIS_URL` 可连接

### 5.3 无权访问作品/章节（403）
原因：作品与章节属于创建者用户；非归属用户访问会被拒绝。

解决：
- 切换到创建该内容的账号

## 6. 相关文档

- API：见 [API文档.md](file:///d:/./.Programs/.Program.Project/Novel-IDE-Web/docs/API文档.md)
- 部署：见 [部署文档.md](file:///d:/./.Programs/.Program.Project/Novel-IDE-Web/docs/部署文档.md)
- Specs：见 [docs/specs](file:///d:/./.Programs/.Program.Project/Novel-IDE-Web/docs/specs)
