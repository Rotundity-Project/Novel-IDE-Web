# Novel-Studio-Web 项目结构文档

## 1. 整体结构

```
Novel-Studio-Web/
├── app/                      # Next.js App Router
│   ├── (auth)/              # 认证相关页面
│   ├── (editor)/            # 编辑器主界面
│   ├── api/                 # API Routes
│   ├── layout.tsx
│   ├── page.tsx
│   └── globals.css
│
├── server/                   # 后端项目
│   ├── src/                  # 源代码
│   ├── prisma/               # 数据库
│   ├── tests/                # 测试文件
│   ├── config/               # 配置文件
│   ├── package.json
│   ├── tsconfig.json
│   └── .env.example
│
├── docs/                    # 文档
│   ├── 设计文档.md
│   ├── API文档.md
│   ├── 数据库设计.md
│   ├── UI-UX设计文档.md
│   ├── 智能体系统设计.md
│   ├── LLM集成架构.md
│   ├── 安全设计.md
│   ├── 开发规范.md
│   ├── 部署文档.md
│   ├── 测试计划.md
│   ├── 项目路线图.md
│   └── 项目结构.md
│
├── scripts/                 # 脚本文件
│   ├── setup.sh
│   ├── deploy.sh
│   ├── backup-db.sh
│   └── server-setup.sh
│
├── docker/                  # Docker 配置
│   ├── docker-compose.yml
│   ├── client.Dockerfile
│   └── server.Dockerfile
│
├── .gitignore
├── LICENSE
├── README.md
├── CHANGELOG.md
├── CONTRIBUTING.md
├── .env.example
└── package.json             # 根 package.json
```

---

## 2. 前端结构 (app/)

```
app/
├── public/                     # 公共静态资源
│   ├── favicon.ico
│   ├── logo.svg
│   └── fonts/                 # 字体文件
│
├── src/
│   ├── components/            # 组件
│   │   ├── ui/               # 基础 UI 组件
│   │   │   ├── button.tsx
│   │   │   ├── input.tsx
│   │   │   ├── modal.tsx
│   │   │   ├── dropdown.tsx
│   │   │   └── ...
│   │   │
│   │   ├── layout/           # 布局组件
│   │   │   ├── Header.tsx
│   │   │   ├── Sidebar.tsx
│   │   │   ├── StatusBar.tsx
│   │   │   └── ...
│   │   │
│   │   ├── editor/           # 编辑器组件
│   │   │   ├── Editor.tsx
│   │   │   ├── EditorToolbar.tsx
│   │   │   ├── EditorPanel.tsx
│   │   │   └── OutlinePanel.tsx
│   │   │
│   │   ├── ai/              # AI 相关组件
│   │   │   ├── AIChat.tsx
│   │   │   ├── AIButton.tsx
│   │   │   ├── AIStreamOutput.tsx
│   │   │   └── AgentSelector.tsx
│   │   │
│   │   ├── work/            # 作品相关组件
│   │   │   ├── WorkList.tsx
│   │   │   ├── WorkCard.tsx
│   │   │   ├── ChapterList.tsx
│   │   │   └── ChapterItem.tsx
│   │   │
│   │   └── user/            # 用户相关组件
│   │       ├── UserAvatar.tsx
│   │       ├── UserMenu.tsx
│   │       └── UserSettings.tsx
│   │
│   ├── hooks/               # 自定义 Hooks
│   │   ├── useAuth.ts
│   │   ├── useUser.ts
│   │   ├── useWork.ts
│   │   ├── useChapter.ts
│   │   ├── useAI.ts
│   │   ├── useAgent.ts
│   │   ├── useDebounce.ts
│   │   ├── useLocalStorage.ts
│   │   └── useWebSocket.ts
│   │
│   ├── stores/              # 状态管理 (Zustand)
│   │   ├── authStore.ts
│   │   ├── userStore.ts
│   │   ├── workStore.ts
│   │   ├── editorStore.ts
│   │   └── uiStore.ts
│   │
│   ├── types/               # TypeScript 类型
│   │   ├── user.types.ts
│   │   ├── work.types.ts
│   │   ├── chapter.types.ts
│   │   ├── agent.types.ts
│   │   ├── ai.types.ts
│   │   └── api.types.ts
│   │
│   ├── lib/                 # 工具库
│   │   ├── utils.ts
│   │   ├── format.ts
│   │   ├── validation.ts
│   │   └── constants.ts
│   │
│   └── actions/            # Server Actions
│       ├── auth.actions.ts
│       ├── work.actions.ts
│       ├── chapter.actions.ts
│       └── agent.actions.ts
│
├── app/                     # Next.js App Router
│   ├── (auth)/             # 认证路由组
│   │   ├── login/
│   │   │   └── page.tsx
│   │   ├── register/
│   │   │   └── page.tsx
│   │   └── layout.tsx
│   │
│   ├── (editor)/           # 编辑器路由组
│   │   ├── works/
│   │   │   ├── page.tsx
│   │   │   └── [id]/
│   │   │       ├── page.tsx
│   │   │       └── chapters/
│   │   │           └── [chapterId]/
│   │   │               └── page.tsx
│   │   └── layout.tsx
│   │
│   ├── agents/             # 智能体路由
│   │   ├── page.tsx
│   │   └── [id]/
│   │       └── page.tsx
│   │
│   ├── settings/           # 设置路由
│   │   ├── profile/page.tsx
│   │   └── account/page.tsx
│   │
│   ├── api/                # API Routes
│   │   ├── auth/
│   │   │   └── [...nextauth]/
│   │   │       └── route.ts
│   │   └── ai/
│   │       └── stream/
│   │           └── route.ts
│   │
│   ├── layout.tsx          # 根布局
│   ├── page.tsx            # 首页
│   ├── globals.css         # 全局样式
│   └── favicon.ico
│
├── e2e/                    # 端到端测试
│   ├── auth.spec.ts
│   ├── editor.spec.ts
│   └── ai.spec.ts
│
├── tests/                  # 测试配置
│   └── setup.ts
│
├── next.config.ts
├── tsconfig.json
├── tailwind.config.ts
├── postcss.config.js
└── .env.example
```

---

## 3. 后端结构 (server/)

```
server/
├── src/
│   ├── controllers/         # 控制器
│   │   ├── auth.controller.ts
│   │   ├── user.controller.ts
│   │   ├── work.controller.ts
│   │   ├── chapter.controller.ts
│   │   ├── agent.controller.ts
│   │   ├── ai.controller.ts
│   │   └── file.controller.ts
│   │
│   ├── services/            # 服务层
│   │   ├── auth.service.ts
│   │   ├── user.service.ts
│   │   ├── work.service.ts
│   │   ├── chapter.service.ts
│   │   ├── agent.service.ts
│   │   ├── ai.service.ts
│   │   └── file.service.ts
│   │
│   ├── repositories/        # 数据访问层
│   │   ├── user.repository.ts
│   │   ├── work.repository.ts
│   │   ├── chapter.repository.ts
│   │   ├── agent.repository.ts
│   │   └── ai-request.repository.ts
│   │
│   ├── models/              # 数据模型
│   │   └── index.ts
│   │
│   ├── middleware/          # 中间件
│   │   ├── auth.middleware.ts
│   │   ├── error.middleware.ts
│   │   ├── validation.middleware.ts
│   │   ├── rate-limit.middleware.ts
│   │   └── logger.middleware.ts
│   │
│   ├── routes/              # 路由
│   │   ├── index.ts
│   │   ├── auth.routes.ts
│   │   ├── user.routes.ts
│   │   ├── work.routes.ts
│   │   ├── chapter.routes.ts
│   │   ├── agent.routes.ts
│   │   ├── ai.routes.ts
│   │   └── file.routes.ts
│   │
│   ├── validators/          # 数据验证
│   │   ├── auth.validator.ts
│   │   ├── work.validator.ts
│   │   ├── chapter.validator.ts
│   │   └── agent.validator.ts
│   │
│   ├── llm/                # LLM 集成
│   │   ├── providers/
│   │   │   ├── base.provider.ts
│   │   │   ├── openai.provider.ts
│   │   │   ├── anthropic.provider.ts
│   │   │   ├── deepseek.provider.ts
│   │   │   └── ollama.provider.ts
│   │   ├── manager.ts
│   │   └── types.ts
│   │
│   ├── agents/             # 智能体系统
│   │   ├── builder.ts
│   │   ├── template.ts
│   │   ├── context.ts
│   │   └── built-in.ts
│   │
│   ├── utils/              # 工具函数
│   │   ├── encryption.ts
│   │   ├── jwt.ts
│   │   ├── logger.ts
│   │   ├── password.ts
│   │   ├── rate-limit.ts
│   │   └── error.ts
│   │
│   ├── types/              # TypeScript 类型
│   │   ├── fastify.d.ts
│   │   └── index.ts
│   │
│   ├── config/             # 配置
│   │   ├── index.ts
│   │   ├── database.ts
│   │   ├── redis.ts
│   │   └── llm.ts
│   │
│   ├── websocket/          # WebSocket
│   │   ├── handler.ts
│   │   └── events.ts
│   │
│   ├── app.ts              # Fastify 应用
│   ├── server.ts           # 服务器入口
│   └── index.ts
│
├── drizzle/                # Drizzle ORM
│   ├── schema.ts           # 数据库 Schema 定义
│   ├── migrations/         # 迁移文件
│   │   └── 0001_init.sql
│   ├── seed.ts             # 种子数据
│   └── config.ts          # Drizzle 配置
│
├── tests/                  # 测试
│   ├── unit/               # 单元测试
│   │   ├── services/
│   │   │   ├── auth.service.test.ts
│   │   │   └── work.service.test.ts
│   │   └── utils/
│   │
│   ├── integration/         # 集成测试
│   │   ├── auth.test.ts
│   │   └── work.test.ts
│   │
│   └── setup.ts            # 测试设置
│
├── config/                 # 配置文件
│   ├── default.yaml
│   ├── development.yaml
│   ├── staging.yaml
│   └── production.yaml
│
├── uploads/                # 上传文件目录
│   └── .gitkeep
│
├── logs/                   # 日志目录
│   └── .gitkeep
│
├── package.json
├── tsconfig.json
├── vitest.config.ts
└── .env.example
```

---

## 4. 文件命名规范

### 4.1 前端

| 类型 | 命名规范 | 示例 |
|------|---------|------|
| 组件文件 | PascalCase | `UserProfile.tsx` |
| 页面文件 | PascalCase + Page | `EditorPage.tsx` |
| Hook 文件 | camelCase + use 前缀 | `useAuth.ts` |
| 服务文件 | camelCase + .service 后缀 | `userService.ts` |
| 类型文件 | camelCase + .types 后缀 | `user.types.ts` |
| 工具文件 | camelCase | `format.ts` |
| 样式文件 | camelCase + .module.css | `Editor.module.css` |

### 4.2 后端

| 类型 | 命名规范 | 示例 |
|------|---------|------|
| 控制器 | camelCase + .controller 后缀 | `auth.controller.ts` |
| 服务 | camelCase + .service 后缀 | `auth.service.ts` |
| 仓库 | camelCase + .repository 后缀 | `user.repository.ts` |
| 中间件 | camelCase + .middleware 后缀 | `auth.middleware.ts` |
| 路由 | camelCase + .routes 后缀 | `auth.routes.ts` |
| 验证器 | camelCase + .validator 后缀 | `auth.validator.ts` |
| 类型 | camelCase | `index.ts` |

---

## 5. 依赖关系

### 5.1 前端依赖分层

```
App
  ↓
Pages (路由页面)
  ↓
Components (UI 组件)
  ↓
Hooks (状态与逻辑)
  ↓
Services (API 调用)
  ↓
Stores (全局状态)
```

### 5.2 后端依赖分层

```
HTTP Request
  ↓
Routes (路由层)
  ↓
Middleware (中间件)
  ↓
Controllers (控制器层)
  ↓
Services (业务逻辑层)
  ↓
Repositories (数据访问层)
  ↓
Database (数据库)
```

---

## 6. 模块职责

### 6.1 前端模块

| 模块 | 职责 |
|------|------|
| `components/ui` | 可复用的基础 UI 组件（按钮、输入框等） |
| `components/layout` | 页面布局组件（导航栏、侧边栏等） |
| `components/editor` | 编辑器相关组件 |
| `components/ai` | AI 功能相关组件 |
| `hooks` | 自定义 Hooks，封装可复用逻辑 |
| `lib/queries` | TanStack Query 数据获取封装 |
| `stores` | Zustand 全局状态管理 |
| `lib` | 工具函数库 |
| `actions` | Next.js Server Actions |

### 6.2 后端模块

| 模块 | 职责 |
|------|------|
| `controllers` | 处理 HTTP 请求，调用服务层 |
| `services` | 业务逻辑处理 |
| `repositories` | 数据库操作封装 |
| `middleware` | 请求拦截、认证、验证等 |
| `routes` | 定义 API 路由 |
| `validators` | 请求数据验证 |
| `llm` | LLM 集成 |
| `agents` | 智能体系统 |
| `websocket` | WebSocket 处理 |

---

## 7. 配置文件说明

### 7.1 前端配置

| 文件 | 说明 |
|------|------|
| `next.config.ts` | Next.js 配置 |
| `tsconfig.json` | TypeScript 配置 |
| `tailwind.config.ts` | Tailwind CSS 配置 |
| `postcss.config.js` | PostCSS 配置 |
| `.env` | 环境变量 |

### 7.2 后端配置

| 文件 | 说明 |
|------|------|
| `tsconfig.json` | TypeScript 配置 |
| `prisma/schema.prisma` | 数据库模型定义 |
| `config/*.yaml` | 应用配置文件 |
| `.env` | 环境变量 |

---

**文档版本**: v1.0
**最后更新**: 2026-02-11
